<ToolBox>
    <ToolButton caption="#Refresh" action="refresh"/>
    <ToolButton caption="#Add" action="add_storage"/>
    <ToolButton caption="#Delete" danger action="del_storage"/>
</ToolBox>
<EntityTable cref:table entity="{db.Storage}"/>

<python>
from apps.storage.data import *
from pony.orm import db_session
from components.Dialogs import *
from core.ctx import *

def refresh(node=None):
    refs.table.refresh(True)

def add_storage(node):
    w, new = ctx.scope.tasks.add_window('storage#', 'New storage', ctx)
    if new:
        w.render('StorageForm')

def del_storage(node):
    row_id = refs.table.active_row_id
    if not row_id: return
    with db_session:
        name = str(db.Storage[row_id])

    def confirm_delete(command: str):
        if command == 'Yes':
            with db_session:
                item = db.Storage[row_id]
                item.delete()
            refresh()

    make_dialog(ctx, _('Confirm deletion of {name}'), callback=confirm_delete)

</python>